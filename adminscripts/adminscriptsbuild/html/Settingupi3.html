
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>SETTING UP LOCAL INSTANCE OF I3 &#8212; adminscripts masterv1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Back-up and Restore of I3 instance" href="Backupscript.html" />
    <link rel="prev" title="SETTING UP LOCAL INSTANCE OF I3" href="adminscripts.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="setting-up-local-instance-of-i3">
<h1><strong>SETTING UP LOCAL INSTANCE OF I3</strong><a class="headerlink" href="#setting-up-local-instance-of-i3" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2><strong>Requirements</strong><a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Ubuntu 16.04 or 18.04</li>
<li>Minimum of 30gb space</li>
</ul>
<img alt="_images/pic1.jpg" src="_images/pic1.jpg" />
<p>The I3 marketplace is implemented with a web-based marketplace frontend connected to a publish-subscribe broker backend. The website allows sellers to post streaming data products, buyers to purchase them, and then the broker allows the corresponding data river to flow from the authorized seller to the buyer.</p>
<div class="section" id="front-end">
<h3><strong>Front-End</strong><a class="headerlink" href="#front-end" title="Permalink to this headline">¶</a></h3>
<p>The frontend of I3 is a marketplace built using ‘Apache &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Apache_HTTP_Server">https://en.wikipedia.org/wiki/Apache_HTTP_Server</a>&gt;’_, ‘a free and open-source cross-platform web server &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Free_and_open-source_software">https://en.wikipedia.org/wiki/Free_and_open-source_software</a>&gt;’_software. I3 is also built upon the open source code by ‘Digital Marketplace &lt;<a class="reference external" href="https://github.com/codingforentrepreneurs/digital-marketplace">https://github.com/codingforentrepreneurs/digital-marketplace</a>&gt;’_, which provided much of the structure and functionality for buying and selling digital products. Digital Marketplace is an implementation of Django. We have transitioned from Django version to Apache version.</p>
</div>
<div class="section" id="back-end">
<h3><strong>Back-End</strong><a class="headerlink" href="#back-end" title="Permalink to this headline">¶</a></h3>
<p>The backend uses ‘eclipse mosquitto &lt;<a class="reference external" href="https://mosquitto.org/">https://mosquitto.org/</a>&gt;’_, an implementation of ‘MQTT &lt;<a class="reference external" href="http://mqtt.org/">http://mqtt.org/</a>&gt;’_ protocol, as the platform to broker messages between publishers and subscribers.</p>
</div>
<div class="section" id="clients">
<h3><strong>Clients</strong><a class="headerlink" href="#clients" title="Permalink to this headline">¶</a></h3>
<p>Sample publisher and subscriber codes.</p>
</div>
<div class="section" id="gateways-backnets">
<h3><strong>Gateways/Backnets</strong><a class="headerlink" href="#gateways-backnets" title="Permalink to this headline">¶</a></h3>
<p>This is a publisher client that gets data from University of Southern California’s BACnet network. It can be used by any other BACnet network. Many automated buildings employ BACnet equipment.</p>
</div>
<div class="section" id="scripts">
<h3><strong>Scripts</strong><a class="headerlink" href="#scripts" title="Permalink to this headline">¶</a></h3>
<p>Scripts to be run at boot up.
Run the i3_start.sh script in order to start the whole iotm project.</p>
<p>The .sh files are shell scripts that can be executed to start the processes (you can call it in /etc/rc.local). This is not a safe method, since it does not restart the processes after a crash, just starts them once.
The .service files are systemd files that can to use to start Ubuntu services during bootup time. These files have to be copied (or linked) to /etc/systemd/system. The systemd was introduced in Ubuntu 16.04, so old versions have to use upstart system To enable the services: $ systemctl enable &lt;service_name&gt; $ systemctl start &lt;service_name&gt;
The files without extension are scripts to be used by System V. They have to be used on Ubuntu 14.04 or older. To enable the services: $ service &lt;service_name&gt; enable</p>
<p>There are three main services or scripts that need to be started:</p>
<ul class="simple">
<li>i3_marketplace</li>
<li>i3_mosquitto</li>
<li>i3_parser_agent</li>
</ul>
</div>
</div>
<div class="section" id="i3-installation-on-ubuntu-16-04-or-18-03">
<h2><strong>I3 installation on Ubuntu 16.04 or 18.03</strong><a class="headerlink" href="#i3-installation-on-ubuntu-16-04-or-18-03" title="Permalink to this headline">¶</a></h2>
<div class="section" id="step-1-cloning-the-repository">
<h3><strong>Step 1: Cloning the repository</strong><a class="headerlink" href="#step-1-cloning-the-repository" title="Permalink to this headline">¶</a></h3>
<p>Open a terminal on Ubuntu using Ctrl + Alt + T or using the search bar. Clone the repository onto your system using the following command git clone <strong>https://github.com/ANRGUSC/iotm.git</strong>.</p>
<p>You will be asked for the login credentials for your user account such as Username and Password for your github account. Enter the credentials accordingly. The cloning of the repository will be completed within a minute or two.</p>
</div>
<div class="section" id="step-2-downloading-docker-and-docker-compose-onto-your-system">
<h3><strong>Step 2: Downloading docker and docker compose onto your system.</strong><a class="headerlink" href="#step-2-downloading-docker-and-docker-compose-onto-your-system" title="Permalink to this headline">¶</a></h3>
<p>The whole project can be run using docker. If you do not have docker installed please visit <a class="reference external" href="https://docs.docker.com/install/">https://docs.docker.com/install/</a> and follow instructions for installions for your respective machine. Download docker from this link <a class="reference external" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a></p>
<p>The whole project can be run using docker. If you do not have docker installed please visit <a class="reference external" href="https://docs.docker.com/install/">https://docs.docker.com/install/</a> and follow instructions for installions for your respective machine.</p>
<p>You should install docker compose. Visit <a class="reference external" href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a> and install docker compose on your system. Install docker compose on your ubuntu using curl.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>After installation of docker compose is complete, please verify the installation using the following command
docker-compose –version
docker-compose version 1.24.1, build 1110ad01
</pre></div>
</div>
<p>Here is the screenshot of the installation completion :</p>
<img alt="_images/pic2.jpg" src="_images/pic2.jpg" />
</div>
<div class="section" id="step3-setting-up-i3-on-your-machine">
<h3><strong>Step3 : Setting up i3 on your machine</strong><a class="headerlink" href="#step3-setting-up-i3-on-your-machine" title="Permalink to this headline">¶</a></h3>
<p>Change the directory using the cd command and go to iotm directory and then to the scripts directory on your terminal
cd iotm
cd scripts</p>
<p>Run the script using ./&lt;fileName&gt; from your terminal.</p>
<ul class="simple">
<li>Run <strong>./setup.sh</strong> script first.</li>
</ul>
<p>You may encounter the following error :
<strong>bash: ./setup.sh: Permission denied</strong></p>
<p><strong>Solution</strong>:
Change the permission for this script. Run sudo chmod 777 setup.sh. You will be asked for your password. Please enter the password. The file permissions will be modified. Please visit <a class="reference external" href="https://www.maketecheasier.com/file-permissions-what-does-chmod-777-means/">https://www.maketecheasier.com/file-permissions-what-does-chmod-777-means/</a> for further understanding about changing file permissions.</p>
<p>Then again run ./setup.sh on your terminal. You will be asked to enter your github username and password. Go ahead and enter them. The setting up of I3 instance on your system will begin.</p>
<p>Please look at the setup.sh file in order to see the actual commands being run.</p>
<img alt="_images/pic3.jpg" src="_images/pic3.jpg" />
<img alt="_images/pic4.jpg" src="_images/pic4.jpg" />
<ul class="simple">
<li>Run <strong>i3_start.sh</strong> script</li>
</ul>
<p>Run the i3_start.sh script that is placed under scripts. This starts the <strong>frontend, backend, parser agent, http to mqtt converter, and mysql server</strong>. The script also makes a few changes to the started containers in order for the marketplace to successfully run. Please look at the i3_start.sh file in order to see the actual commands being run.
Run the following command <strong>sudo ./i3_start.sh</strong> . If you just run ./i3_start.sh, you will encounter a permission denied error. <strong>Please look at the end of document for troubleshooting steps</strong>.</p>
<img alt="_images/pic5.jpg" src="_images/pic5.jpg" />
<p>You will be prompted to enter the database password.</p>
<img alt="_images/pic6.jpg" src="_images/pic6.jpg" />
<p>The password is <strong>AnRg&#64;UsC</strong>. Go ahead and enter the password.</p>
</div>
<div class="section" id="step4-creating-a-super-user-to-log-in-to-i3-website">
<h3><strong>Step4 : Creating a super user to Log-in to I3 website</strong><a class="headerlink" href="#step4-creating-a-super-user-to-log-in-to-i3-website" title="Permalink to this headline">¶</a></h3>
<p>Now that you have I3 up and running, there is no default user and password. A super user must be created through the Django container.</p>
<ol class="arabic simple">
<li>Enter the Django container shell:</li>
</ol>
<dl class="docutils">
<dt>::</dt>
<dd>$ sudo docker exec -it iotm_django_1 /bin/bash</dd>
</dl>
<ol class="arabic simple" start="2">
<li>Run this python script:</li>
</ol>
<dl class="docutils">
<dt>::</dt>
<dd>python manage.py createsuperuser</dd>
</dl>
<ol class="arabic simple" start="3">
<li>Fill in the user details, and type exit on the terminal once the super user is created.</li>
<li>Try Logging in with the super user credentials you just created.</li>
</ol>
<img alt="_images/pic7.jpg" src="_images/pic7.jpg" />
</div>
<div class="section" id="step5-mqtt-acl-table-creation">
<h3><strong>Step5 : MQTT ACL table creation</strong><a class="headerlink" href="#step5-mqtt-acl-table-creation" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Enter the mysql container shell:</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker exec -it mysql bash
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Navigate to /var/log/mosquitto and change the permissions of mosquitto.log file.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd /var/log/mosquitto
$ chmod 755 mosquitto.log
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Then, run this mysql command:</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mysql -u anrg_iotm -pAnRg@UsC
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Load the example user and acl tables in the database (database: iotm2):</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">use</span> <span class="n">iotm2</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">source</span> <span class="n">mysql</span><span class="o">.</span><span class="n">sql</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">exit</span>
</pre></div>
</div>
</div>
<div class="section" id="step6-access-i3-marketplace-website">
<h3><strong>Step6 : Access I3 Marketplace website</strong><a class="headerlink" href="#step6-access-i3-marketplace-website" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Open a web browser and type his url: localhost:8000</li>
<li>Log-in with the super user credentials.</li>
<li>After logging in, you should see the Dashboard page.</li>
</ol>
<img alt="_images/pic8.jpg" src="_images/pic8.jpg" />
<img alt="_images/pic9.jpg" src="_images/pic9.jpg" />
</div>
</div>
<div class="section" id="mysql-troubleshooting">
<h2><strong>MySQL Troubleshooting</strong><a class="headerlink" href="#mysql-troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="case-1">
<h3><strong>Case 1</strong>:<a class="headerlink" href="#case-1" title="Permalink to this headline">¶</a></h3>
<p>Upon build, if django.db.utils.OperationalError: (1130, “Host ‘(Your IP Address)’ is not allowed to connect to this MySQL server”) is thrown, please follow the steps below:</p>
<p>Remove the existing mysql contiainer by running these commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker kill mysql
$ docker rm -f mysql
</pre></div>
</div>
</div>
<div class="section" id="case-2">
<h3><strong>Case 2</strong>:<a class="headerlink" href="#case-2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Starting</span> <span class="n">mysql</span> <span class="o">...</span> <span class="n">error</span>

<span class="n">ERROR</span><span class="p">:</span> <span class="k">for</span> <span class="n">mysql</span>  <span class="n">Cannot</span> <span class="n">start</span> <span class="n">service</span> <span class="n">mysql</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;driver failed programming external connectivity on endpoint mysql (47c15280369b9e78c6a291047dcf77a9e24711447d4704a8c626c066cd9fb31f): Error starting userland proxy: listen tcp 0.0.0.0:(some port number): bind: address already in use&#39;</span>

<span class="n">ERROR</span><span class="p">:</span> <span class="k">for</span> <span class="n">mysql</span>  <span class="n">Cannot</span> <span class="n">start</span> <span class="n">service</span> <span class="n">mysql</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;driver failed programming external connectivity on endpoint mysql (47c15280369b9e78c6a291047dcf77a9e24711447d4704a8c626c066cd9fb31f): Error starting   userland proxy: listen tcp 0.0.0.0:(some port number): bind: address already in use&#39;</span>
<span class="n">ERROR</span><span class="p">:</span> <span class="n">Encountered</span> <span class="n">errors</span> <span class="k">while</span> <span class="n">bringing</span> <span class="n">up</span> <span class="n">the</span> <span class="n">project</span><span class="o">.</span>
<span class="n">ERROR</span><span class="p">:</span> <span class="n">No</span> <span class="n">container</span> <span class="n">found</span> <span class="k">for</span> <span class="n">django_1</span>
<span class="n">Starting</span> <span class="n">mysql</span> <span class="o">...</span> <span class="n">error</span>
<span class="o">....</span>
</pre></div>
</div>
<p>This means that some application is already listen on the port specified. This could be due to previous i3 starts. To know which application is listening, run this command: sudo netstat -plnt | grep ‘:(port number)’</p>
<p>In the last column, it should say the name of the application running. Simply stop it with this command: sudo systemctl stop PROGRAM_NAME</p>
</div>
<div class="section" id="case-3">
<h3><strong>Case 3</strong>:<a class="headerlink" href="#case-3" title="Permalink to this headline">¶</a></h3>
<p>(MAC) Upon build, if this is error comes up: Starting 7b18c081fda8_mysql … error ERROR: for 7b18c081fda8_mysql Cannot start service mysql: b’driver failed programming external connectivity on endpoint 7b18c081fda8_mysql (0a6be91417b839ae095bd28bcf2e85c521f5fbe976bae0c2260448487f4eda3b): Error starting userland proxy: Bind for 0.0.0.0:3306 failed: port is already allocated’</p>
<p>This means that MySQL is already running in the specified port in the error message. Need to kill the MySQL instance at that port.</p>
<p>Run :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo lsof -i :(PORT NUMBER)
$ sudo kill -9 (PORT NUMBER) or sudo kill $(lsof -t -i :PORT NUMBER)
</pre></div>
</div>
</div>
</div>
<div class="section" id="features">
<h2><strong>Features</strong><a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Supports TLS 1.2 on port 8883</li>
<li>Supports TLS 1.1 on port 9001</li>
<li>Supports Web Socket on port 9010</li>
<li>Scripts to backup I3 instance and restore</li>
<li>Scripts to setup I3 on both ubuntu and debian instance</li>
<li>Automated installation of I3 instance</li>
</ol>
</div>
<div class="section" id="license">
<h2><strong>License</strong><a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>MIT</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="adminscripts.html">adminscripts</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>SETTING UP LOCAL INSTANCE OF I3</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#i3-installation-on-ubuntu-16-04-or-18-03"><strong>I3 installation on Ubuntu 16.04 or 18.03</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#mysql-troubleshooting"><strong>MySQL Troubleshooting</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#features"><strong>Features</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#license"><strong>License</strong></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Backupscript.html"><strong>Back-up and Restore of I3 instance</strong></a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="adminscripts.html">Documentation overview</a><ul>
      <li>Previous: <a href="adminscripts.html" title="previous chapter">SETTING UP LOCAL INSTANCE OF I3</a></li>
      <li>Next: <a href="Backupscript.html" title="next chapter"><strong>Back-up and Restore of I3 instance</strong></a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, varshashesh.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/Settingupi3.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>