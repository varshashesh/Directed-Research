
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Back-up and Restore of I3 instance &#8212; adminscripts masterv1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="SETTING UP LOCAL INSTANCE OF I3" href="Settingupi3.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="back-up-and-restore-of-i3-instance">
<h1><strong>Back-up and Restore of I3 instance</strong><a class="headerlink" href="#back-up-and-restore-of-i3-instance" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Back-up Script</li>
<li>Restore Scipt</li>
</ul>
<p>The Back-up script lets you store a copy of your I3 database locally on a periodic bases. The Restore script lets you recreate an instance or recover your previous state of the I3 instance.</p>
<div class="section" id="back-up-folder">
<h2><strong>Back-up Folder</strong><a class="headerlink" href="#back-up-folder" title="Permalink to this headline">¶</a></h2>
<p>The script creates a directory which consists of two folders and a Mosquitto log. First folder to consist of all the dynamic data that is updated on a daily basis. Second folder to consist of the static files. Third the Mosquitto log that keeps track of the MQTT system status from the initialization of I3 instance.</p>
<img alt="_images/backup2.png" src="_images/backup2.png" />
<p>The first folder is named in YYYY-MM-DD format using the</p>
<p>Run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ date +%Y-%m-%d
</pre></div>
</div>
<p>command in shell scripting. This done to differentiate the folders based on the back up dates. The output will be a timely log of the instance.</p>
<p>The Django and MySQL files are named with the date when the script is run. Django dump saved as a .json file and the  MySQL dump saved as a .sql file. The script pulls the dumps from their respctive Docker containers using their respective conatiner IDs. This folder basically contains the data needed for the back end to start off.</p>
<p>The static files consist of the product images that are displayed on the HTML page. This folder contains the front end data segreagated as media and protected folders.</p>
<p>Third the Mosquitto log is saved using the epoch time with the corresponding system status in a two column format.</p>
</div>
<div class="section" id="back-up-script">
<h2><strong>Back-up Script</strong><a class="headerlink" href="#back-up-script" title="Permalink to this headline">¶</a></h2>
<p>The Back-up script is a Bash file named <strong>backup.sh</strong> found in the scripts folder of IOTM along with the setup.sh and i3_start.sh scripts.There are two place holder variables in the script that can be changed to preference. One is the path and other is days of rotation.</p>
<p><strong>Updating the Parameters</strong>
The backup path has to be changed according to your preference in the script. In the example format <strong>“/home/ubuntu/backup/”</strong>. Note to put a “/” at the end of the path so that the files are copied inside the directory. The trailing slash “/” makes sure that the path is a directory and not a file. Update the path in the BACKUP_LOCATION variable shown in the image below.</p>
<img alt="_images/backup5.png" src="_images/backup5.png" />
<p>The rotational backup of the directories and the mosquitto log is done by default for 31 days. Change the <strong>DAYS</strong> variable to update the preferred number of days of rotation as shown in the image above.</p>
<p><strong>Running the Back-up Script</strong>
Make the Bash file of the Back-up script executable by running the
Run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo chmod +x backup.sh
</pre></div>
</div>
<p>Alternatively you can also, Right click on your script and chose <strong>Properties -&gt; Permissions -&gt; Allow executing file as program</strong>, leaves you with the exact same result as the command in terminal.</p>
<p>Then, the script can be run using
Run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo ./backup.sh
</pre></div>
</div>
<p>In some cases sudo is needed as the Docker deamon binds to the Unix socket instead of a TCP port. By default that Unix socket is owned by the user root by default,and so, you can access it with sudo.</p>
<p>To automate the process, and keep a regular backup: Make use of the <strong>crontab</strong>, more information can be found at: &lt; <a class="reference external" href="https://opensource.com/article/17/11/how-use-cron-linux">https://opensource.com/article/17/11/how-use-cron-linux</a> &gt;
Example:
Run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ crontab -e
</pre></div>
</div>
<img alt="_images/backup6.png" src="_images/backup6.png" />
<p>Update the time as needed. MIN HOUR DOM MON DOW COMMAND</p>
<p>Finally, check for the output as shown in the image. Also, make sure that your Back-up Folder has the mentioned folders and the Mosquittofinal.log is up to date.</p>
</div>
<div class="section" id="restore">
<h2><strong>Restore</strong><a class="headerlink" href="#restore" title="Permalink to this headline">¶</a></h2>
<p>To restore, we need the latest <strong>MySQL dump</strong> and the <strong>static folder</strong> of the instance that we are trying to recreate.
The Restore script copies the MySQL table in to the MySQL Docker container to restore the Usernames and</p>
<p><strong>Running the Restore Script</strong>
Make the Bash file of the Restore script executable by running the
Run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo chmod +x restore.sh
</pre></div>
</div>
<p>Alternatively you can also, Right click on your script and chose <strong>Properties -&gt; Permissions -&gt; Allow executing file as program</strong>, leaves you with the exact same result as the command in terminal.</p>
<p>Then, the script can be run using
Run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo ./restore.sh
</pre></div>
</div>
<p>When prompted on the terminal, enter the path to the Back-up folder containing the latest MySQL dump and static files. When entering the path make sure it is of the format: “/home/ubuntu/backup/” including the trailing slash “/” at the end of the path to make sure it is a directory.</p>
<p>When promted again for the MySQl dump, enter the path to the latest MySQL .sql file. Alternatively you can enter the path to the prefferred MySQL path. The path to be entered will ideally be of the form: ‘/home/ubuntu/backup/2019-11-05/2019-11-05_mysql.sql’</p>
<img alt="_images/restore2.png" src="_images/restore2.png" />
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="adminscripts.html">adminscripts</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Settingupi3.html"><strong>SETTING UP LOCAL INSTANCE OF I3</strong></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Back-up and Restore of I3 instance</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#back-up-folder"><strong>Back-up Folder</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#back-up-script"><strong>Back-up Script</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#restore"><strong>Restore</strong></a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="adminscripts.html">Documentation overview</a><ul>
      <li>Previous: <a href="Settingupi3.html" title="previous chapter"><strong>SETTING UP LOCAL INSTANCE OF I3</strong></a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, varshashesh.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/Backupscript.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>